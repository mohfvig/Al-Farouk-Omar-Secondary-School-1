<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© - Ù…Ø¯Ø±Ø³Ø© Ø§Ù„ÙØ§Ø±ÙˆÙ‚ Ø¹Ù…Ø±</title>
    <link href="style.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet"/>
    <style>
        :root { --danger: #ef4444; --success: #22c55e; }
        
        /* ğŸ”’ Ø´Ø§Ø´Ø© Ø§Ù„Ù‚ÙÙ„ */
        #login-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 9999; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(10px); }
        .dark-mode #login-overlay { background: var(--dark-bg) !important; }
        .login-box { text-align: center; padding: 40px; width: 90%; max-width: 400px; border: 1px solid var(--border); }
        .pass-container { position: relative; margin-bottom: 20px; }
        .toggle-pass { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); cursor: pointer; background: none; border: none; font-size: 18px; color: var(--text); opacity: 0.6; }

        /* Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø®Ø¨Ø§Ø± */
        .stats-bar { display: flex; justify-content: center; margin-bottom: 25px; }
        .stat-card { background: var(--primary); color: white; padding: 12px 30px; border-radius: 50px; font-weight: bold; box-shadow: 0 4px 15px var(--shadow); font-size: 1.1rem; }

        /* Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª */
        .admin-nav { display: flex; gap: 10px; margin-bottom: 25px; border-bottom: 2px solid var(--border); padding-bottom: 10px; }
        .tab-btn { background: none; border: none; padding: 12px 20px; font-family: 'Cairo'; cursor: pointer; color: var(--muted); border-radius: 8px; font-weight: 600; }
        .tab-btn.active { background: var(--primary); color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .admin-card { display: flex; justify-content: space-between; align-items: center; padding: 18px; margin-bottom: 15px; border-right: 5px solid var(--primary); }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); }
        .modal-content { background: var(--card); margin: 8% auto; padding: 25px; width: 95%; max-width: 550px; border-radius: 15px; }
        .dark-mode .modal-content { background: var(--dark-card); color: white; }
    </style>
</head>
<body class="bg">

    <div id="login-overlay">
        <div class="card login-box">
            <h2 style="margin-bottom: 20px;">Ø¯Ø®ÙˆÙ„ Ø¢Ù…Ù† ğŸ”</h2>
            <div class="pass-container">
                <input type="password" id="admin-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" class="card" style="width:100%; padding:15px; text-align:center;">
                <button type="button" class="toggle-pass" onclick="togglePassword()">ğŸ‘ï¸</button>
            </div>
            <button onclick="checkAccess()" class="btn btn-primary" style="width:100%; padding: 14px;">Ø¯Ø®ÙˆÙ„</button>
            <p id="error-msg" style="color:var(--danger); margin-top:10px; display:none;">âš ï¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø·Ø£!</p>
        </div>
    </div>

    <header>
        <div class="wrap brand">
            <div class="title">
                <img src="icon.jpg" id="main-logo" style="height: 45px; border-radius: 5px;">
                <h1>Ø¥Ø¯Ø§Ø±Ø© Ù…Ø¯Ø±Ø³Ø© Ø§Ù„ÙØ§Ø±ÙˆÙ‚</h1>
            </div>
            <button class="btn btn-icon" id="dark-mode-toggle">ğŸŒ™</button>
        </div>
    </header>

    <main class="wrap">
        <div class="stats-bar">
            <div class="stat-card">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø©: <span id="news-count">0</span> Ø®Ø¨Ø±</div>
        </div>

        <div class="admin-nav">
            <button class="tab-btn active" onclick="showTab('add-tab', this)">â• Ø¥Ø¶Ø§ÙØ© Ø®Ø¨Ø±</button>
            <button class="tab-btn" onclick="showTab('manage-tab', this)">ğŸ“‚ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø®Ø¨Ø§Ø±</button>
        </div>

        <section id="add-tab" class="tab-content active">
            <div class="card">
                <input type="text" id="newsTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø®Ø¨Ø±" class="card" style="width:100%; margin-bottom:15px; padding:15px; font-size: 1.1rem;">
                <textarea id="newsContent" placeholder="Ø§ÙƒØªØ¨ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø®Ø¨Ø± Ù‡Ù†Ø§..." class="card" style="width:100%; height:200px; padding:15px; font-family: 'Cairo';"></textarea>
                <button id="publishBtn" class="btn btn-primary" style="width:100%; padding: 15px; font-size: 1.1rem;">ğŸš€ Ù†Ø´Ø± Ø§Ù„Ø®Ø¨Ø± Ø§Ù„Ø¢Ù†</button>
            </div>
        </section>

        <section id="manage-tab" class="tab-content">
            <div id="adminNewsList"></div>
        </section>
    </main>

    <div id="editModal" class="modal">
        <div class="modal-content card">
            <h3>ğŸ“ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø®Ø¨Ø±</h3>
            <input type="hidden" id="editId">
            <input type="text" id="editTitle" class="card" style="width:100%; margin: 15px 0; padding:15px;">
            <textarea id="editContent" class="card" style="width:100%; height:180px; padding:15px; font-family: 'Cairo';"></textarea>
            <div style="display:flex; gap:10px;">
                <button onclick="saveEdit()" class="btn btn-primary" style="flex:2;">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
                <button onclick="closeModal()" class="btn btn-muted" style="flex:1;">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onValue, remove, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAY4DtaYX2toAUB-zNX23mBUEEZeuzE2DI",
            databaseURL: "https://news-f45f8-default-rtdb.firebaseio.com"
        };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // ğŸ”’ Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…Ø®ÙÙŠØ©
        const secret = "bWFuZ2VyMTE0NA=="; 
        window.checkAccess = function() {
            if (btoa(document.getElementById('admin-pass').value) === secret) {
                document.getElementById('login-overlay').style.display = 'none';
                sessionStorage.setItem('admin_auth', 'true');
            } else { document.getElementById('error-msg').style.display = 'block'; }
        };
        if(sessionStorage.getItem('admin_auth') === 'true') document.getElementById('login-overlay').style.display = 'none';

        window.togglePassword = function() {
            const p = document.getElementById('admin-pass');
            p.type = p.type === 'password' ? 'text' : 'password';
        };

        // ğŸ“‚ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø¹Ø¯Ø§Ø¯
        onValue(ref(db, 'news'), (snapshot) => {
            const list = document.getElementById('adminNewsList');
            const countSpan = document.getElementById('news-count');
            const data = snapshot.val();
            list.innerHTML = "";
            
            if (data) {
                const keys = Object.keys(data);
                countSpan.innerText = keys.length;
                keys.reverse().forEach(key => {
                    const item = data[key];
                    list.innerHTML += `
                        <div class="card admin-card">
                            <div><strong>${item.title}</strong><br><small>${item.date}</small></div>
                            <div style="display:flex; gap:8px;">
                                <a href="post.html?id=${key}" class="btn btn-muted" style="text-decoration:none; padding:8px 12px;">ğŸ”— Ù…Ø¹Ø§ÙŠÙ†Ø©</a>
                                <button class="btn btn-muted" onclick="openEdit('${key}', '${item.title.replace(/'/g,"")}', '${item.content.replace(/'/g,"")}')">âœï¸</button>
                                <button class="btn" style="background:var(--danger); color:white; border:none; padding:8px 12px;" onclick="deleteNews('${key}')">ğŸ—‘ï¸</button>
                            </div>
                        </div>`;
                });
            } else { countSpan.innerText = "0"; }
        });

        document.getElementById('publishBtn').onclick = () => {
            const t = document.getElementById('newsTitle').value;
            const c = document.getElementById('newsContent').value;
            if(t && c) {
                push(ref(db, 'news'), { title: t, content: c, date: new Date().toLocaleDateString('ar-EG') })
                .then(() => { alert("âœ… ØªÙ… Ø§Ù„Ù†Ø´Ø±"); location.reload(); });
            }
        };

        window.deleteNews = (id) => { if(confirm("Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø®Ø¨Ø±ØŸ")) remove(ref(db, `news/${id}`)); };
        window.openEdit = (id, title, content) => {
            document.getElementById('editId').value = id;
            document.getElementById('editTitle').value = title;
            document.getElementById('editContent').value = content;
            document.getElementById('editModal').style.display = 'block';
        };
        window.closeModal = () => document.getElementById('editModal').style.display = 'none';
        window.saveEdit = () => {
            update(ref(db, `news/${document.getElementById('editId').value}`), {
                title: document.getElementById('editTitle').value,
                content: document.getElementById('editContent').value
            }).then(() => { closeModal(); alert("âœ… ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„"); });
        };

        window.showTab = (tabId, btn) => {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            btn.classList.add('active');
        };
    </script>

    <script>
        // ğŸŒ™ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ Ù…Ø¹ Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø©
        const toggleBtn = document.getElementById('dark-mode-toggle');
        if (localStorage.getItem('theme') === 'dark') document.body.classList.add('dark-mode');
        toggleBtn.onclick = () => {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            toggleBtn.textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
        };
    </script>
</body>
</html>
